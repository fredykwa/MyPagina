<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profe Digital Kwa - Plataforma Educativa Interactiva</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover, .card-hover:focus-within {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .animation-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid #e2e8f0;
        }
        .section-hidden {
            display: none;
        }
        /* Estilos para las Pesta√±as de Lecci√≥n */
        .lesson-tab {
            cursor: pointer;
            padding: 0.75rem 1.25rem;
            border-bottom: 3px solid transparent;
            font-weight: 600;
            color: #6b7280; /* text-gray-500 */
        }
        .lesson-tab:hover {
            color: #111827; /* text-gray-900 */
        }
        .lesson-tab.active {
            color: #4f46e5; /* text-indigo-600 */
            border-bottom-color: #4f46e5; /* border-indigo-600 */
        }
        .lesson-content {
            display: none;
        }
        .lesson-content.active {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg sticky top-0 z-40">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3 cursor-pointer" onclick="showSection('inicio')">
                    <div class="bg-white bg-opacity-20 p-2 rounded-lg">
                        <span class="text-2xl">üìö</span>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold">Profe Digital Kwa</h1>
                        <p class="text-sm opacity-90">Plataforma Educativa Interactiva</p>
                    </div>
                </div>
                <nav class="hidden md:flex space-x-6 items-center">
                    <a href="#" onclick="event.preventDefault(); showSection('inicio')" class="hover:text-blue-200 transition-colors">Inicio</a>
                    <a href="#" onclick="event.preventDefault(); showSection('matematicas')" class="hover:text-blue-200 transition-colors">Matem√°ticas</a>
                    <a href="#" onclick="event.preventDefault(); showSection('fisica')" class="hover:text-blue-200 transition-colors">F√≠sica</a>
                    <a href="#" onclick="event.preventDefault(); showSection('animaciones')" class="bg-white bg-opacity-20 px-4 py-2 rounded-lg hover:bg-opacity-30 transition-colors">Todas las Animaciones</a>
                </nav>
                <button class="md:hidden text-white" onclick="toggleMobileMenu()">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
            <!-- Mobile Menu -->
            <div id="mobileMenu" class="hidden md:hidden mt-4 pb-4">
                <a href="#" onclick="event.preventDefault(); showSection('inicio')" class="block py-2 hover:text-blue-200">Inicio</a>
                <a href="#" onclick="event.preventDefault(); showSection('matematicas')" class="block py-2 hover:text-blue-200">Matem√°ticas</a>
                <a href="#" onclick="event.preventDefault(); showSection('fisica')" class="block py-2 hover:text-blue-200">F√≠sica</a>
                <a href="#" onclick="event.preventDefault(); showSection('animaciones')" class="block py-2 hover:text-blue-200">Todas las Animaciones</a>
            </div>
        </div>
    </header>

    <!-- Breadcrumb -->
    <nav id="breadcrumb" class="container mx-auto px-6 py-4" aria-label="Breadcrumb">
        <ol class="inline-flex items-center space-x-1 md:space-x-3">
            <li class="inline-flex items-center">
                <a href="#" onclick="event.preventDefault(); showSection('inicio')" class="text-gray-700 hover:text-blue-600">üè† Inicio</a>
            </li>
            <li id="breadcrumbSection" class="hidden">
                <div class="flex items-center">
                    <svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    <span id="breadcrumbText" class="ml-1 text-gray-500 md:ml-2"></span>
                </div>
            </li>
        </ol>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-6 pb-8">
        <section id="inicio" class="section"></section>
        <section id="matematicas" class="section section-hidden"></section>
        <section id="fisica" class="section section-hidden"></section>
        <section id="animaciones" class="section section-hidden"></section>
        <section id="animationDetail" class="section section-hidden">
            <div id="animationContent"></div>
        </section>
    </main>

    <!-- Admin Panel Toggle -->
    <div id="adminToggle" class="fixed bottom-6 right-6 z-50">
        <button onclick="toggleAdminPanel()" class="bg-gray-800 hover:bg-gray-700 text-white p-3 rounded-full shadow-lg transition-all duration-300 transform hover:scale-110" title="Panel de Administraci√≥n">
            üîë
        </button>
    </div>
    <!-- Admin Panel Modal -->
    <div id="adminPanel" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                <div class="bg-gradient-to-r from-gray-800 to-gray-900 text-white p-6 rounded-t-xl sticky top-0 z-10">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="bg-white bg-opacity-20 p-2 rounded-lg">üîë</div>
                            <div><h2 class="text-2xl font-bold">Panel de Administraci√≥n</h2><p class="text-gray-300">Gestiona contenido y animaciones</p></div>
                        </div>
                        <button onclick="toggleAdminPanel()" class="text-white hover:text-gray-300 text-2xl">‚úï</button>
                    </div>
                </div>
                <div class="p-6">
                    <div class="flex border-b border-gray-200 mb-6">
                        <button onclick="showAdminTab('animations', event)" class="admin-tab-btn px-6 py-3 font-semibold text-blue-600 border-b-2 border-blue-600">üé¨ Gestionar Animaciones</button>
                        <button onclick="showAdminTab('content', event)" class="admin-tab-btn px-6 py-3 font-semibold text-gray-500 hover:text-gray-700">üìù Gestionar Contenido</button>
                        <button onclick="showAdminTab('settings', event)" class="admin-tab-btn px-6 py-3 font-semibold text-gray-500 hover:text-gray-700">‚öôÔ∏è Configuraci√≥n</button>
                    </div>
                    <div id="adminAnimations" class="admin-tab-content">
                        <div class="mb-6">
                            <h3 class="text-xl font-bold mb-4">Agregar/Editar Animaci√≥n</h3>
                            <form id="addAnimationForm" class="space-y-4">
                                <input type="hidden" id="animationId">
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div><label class="block text-sm font-medium text-gray-700 mb-2">T√≠tulo</label><input type="text" id="animationTitle" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Ej: Teorema de Pit√°goras" required></div>
                                    <div><label class="block text-sm font-medium text-gray-700 mb-2">Materia</label><select id="animationSubject" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><option value="matematicas">üìê Matem√°ticas</option><option value="fisica">üî¨ F√≠sica</option><option value="quimica">‚öóÔ∏è Qu√≠mica</option></select></div>
                                </div>
                                <div><label class="block text-sm font-medium text-gray-700 mb-2">URL de la Animaci√≥n (iframe)</label><input type="url" id="animationUrl" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="https://fredykwa.github.io/..." required></div>
                                <div><label class="block text-sm font-medium text-gray-700 mb-2">Descripci√≥n Breve (para la tarjeta)</label><textarea id="animationDescription" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Descripci√≥n breve de la animaci√≥n" required></textarea></div>
                                <div><label class="block text-sm font-medium text-gray-700 mb-2">Palabras Clave (separadas por espacios)</label><input type="text" id="animationKeywords" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="geometr√≠a tri√°ngulos teorema pit√°goras"></div>
                                <div><label class="block text-sm font-medium text-gray-700 mb-2">Objetivos de Aprendizaje (uno por l√≠nea)</label><textarea id="animationObjectives" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Comprender el teorema de Pit√°goras&#10;Aplicar la f√≥rmula en problemas"></textarea></div>
                                <div><label class="block text-sm font-medium text-gray-700 mb-2">Controles Interactivos (uno por l√≠nea)</label><textarea id="animationControls" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Ajusta los lados del tri√°ngulo&#10;Observa c√≥mo cambia la hipotenusa"></textarea></div>
                                <div class="border-t border-gray-200 pt-4"><label class="block text-sm font-medium text-gray-700 mb-2">Explicaci√≥n Te√≥rica (Acepta HTML)</label><textarea id="animationTheory" rows="5" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="<p>Una fracci√≥n es un n√∫mero que...</p><ul><li>Numerador</li>...</ul>"></textarea></div>
                                <div><label class="block text-sm font-medium text-gray-700 mb-2">Ejemplos Resueltos (Acepta HTML)</label><textarea id="animationExamples" rows="5" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="<h4>Ejemplo 1:</h4><p>Si tenemos 3/4...</p>"></textarea></div>
                                <div><label class="block text-sm font-medium text-gray-700 mb-2">Desaf√≠o (Acepta HTML)</label><textarea id="animationChallenge" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="<h4>¬°Ponte a prueba!</h4><p>¬øQu√© fracci√≥n es mayor, 2/3 o 5/6?</p>"></textarea></div>
                                <div class="flex space-x-4"><button type="submit" id="formSubmitButton" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors">‚ûï Agregar Animaci√≥n</button><button type="button" id="formCancelButton" class="bg-gray-200 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-300 transition-colors hidden" onclick="resetAdminForm()">Cancelar Edici√≥n</button></div>
                            </form>
                        </div>
                        <div class="border-t pt-6"><h3 class="text-xl font-bold mb-4">Animaciones Existentes</h3><div id="existingAnimations" class="space-y-4"></div></div>
                    </div>
                    <div id="adminContent" class="admin-tab-content hidden"></div>
                    <div id="adminSettings" class="admin-tab-content hidden"></div>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer -->
    <footer class="bg-gray-800 text-white mt-16">
        <div class="container mx-auto px-6 py-8">
            <div class="grid md:grid-cols-4 gap-8">
                <div><h4 class="text-lg font-semibold mb-4">Profe Digital Kwa</h4><p class="text-gray-400">Plataforma educativa interactiva para el aprendizaje de matem√°ticas y ciencias.</p></div>
                <div><h4 class="text-lg font-semibold mb-4">Materias</h4><ul class="space-y-2 text-gray-400"><li><a href="#" onclick="event.preventDefault(); showSection('matematicas')" class="hover:text-white">Matem√°ticas</a></li><li><a href="#" onclick="event.preventDefault(); showSection('fisica')" class="hover:text-white">F√≠sica</a></li><li><a href="#" class="hover:text-white">Qu√≠mica</a></li></ul></div>
                <div><h4 class="text-lg font-semibold mb-4">Recursos</h4><ul class="space-y-2 text-gray-400"><li><a href="#" onclick="event.preventDefault(); showSection('animaciones')" class="hover:text-white">Animaciones</a></li><li><a href="#" class="hover:text-white">Simuladores</a></li><li><a href="#" class="hover:text-white">Ejercicios</a></li></ul></div>
                <div><h4 class="text-lg font-semibold mb-4">Contacto</h4><ul id="footerContact" class="space-y-2 text-gray-400"><li>üìß info@eduhub.com</li><li>üì± +1 234 567 8900</li></ul></div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400"><p>&copy; 2024 Profe Digital Kwa. Todos los derechos reservados.</p></div>
        </div>
    </footer>

<script>
    // =================================================================================
    // 1. BASE DE DATOS Y ESTADO DE LA APLICACI√ìN
    // =================================================================================
    
    const PORTAL_URL = window.location.href.split('?')[0];

    const ANIMATION_DB = [
        {
            id: 'fracciones', title: 'Representaci√≥n de Fracciones', subject: 'matematicas', url: 'https://fredykwa.github.io/Animaciones-Canvas/RepresentacionFracciones2/',
            description: 'Visualiza y comprende las fracciones de manera interactiva', keywords: 'fracciones numerador denominador pizza pastel',
            isFeatured: true, isDefault: true, icon: 'üìê', gradient: 'from-orange-500 to-red-600', color: 'orange',
            objectives: ['Comprender el concepto de fracciones y sus partes', 'Visualizar fracciones mediante representaciones gr√°ficas', 'Relacionar numerador y denominador con la parte visual'],
            controls: ['Modifica numeradores y denominadores', 'Observa c√≥mo cambia la representaci√≥n visual', 'Experimenta con fracciones equivalentes'],
            svgThumbnail: `<svg viewBox="0 0 300 200" class="w-full h-full"><defs><linearGradient id="pizzaGradient" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#FFD700;stop-opacity:1" /><stop offset="100%" style="stop-color:#FF8C00;stop-opacity:1" /></linearGradient><linearGradient id="sliceGradient" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#FF6B35;stop-opacity:0.9" /><stop offset="100%" style="stop-color:#DC2626;stop-opacity:0.9" /></linearGradient><filter id="shadow" x="-50%" y="-50%" width="200%" height="200%"><feDropShadow dx="2" dy="2" stdDeviation="3" flood-color="#00000030"/></filter></defs><circle cx="102" cy="102" r="60" fill="#00000015"/><circle cx="100" cy="100" r="60" fill="url(#pizzaGradient)" stroke="#E97317" stroke-width="2" filter="url(#shadow)"/><circle cx="85" cy="85" r="3" fill="#DC2626" opacity="0.7"/><circle cx="115" cy="90" r="2.5" fill="#16A34A" opacity="0.7"/><circle cx="95" cy="115" r="2" fill="#DC2626" opacity="0.7"/><circle cx="110" cy="110" r="2.5" fill="#FBBF24" opacity="0.7"/><g stroke="#E97317" stroke-width="1.5" opacity="0.8"><line x1="100" y1="40" x2="100" y2="160"/><line x1="40" y1="100" x2="160" y2="100"/><line x1="57.6" y1="57.6" x2="142.4" y2="142.4"/><line x1="142.4" y1="57.6" x2="57.6" y2="142.4"/></g><path d="M 100 100 L 100 40 A 60 60 0 0 1 142.4 57.6 Z" fill="url(#sliceGradient)" stroke="#DC2626" stroke-width="1"/><path d="M 100 100 L 142.4 57.6 A 60 60 0 0 1 160 100 Z" fill="url(#sliceGradient)" stroke="#DC2626" stroke-width="1"/><path d="M 100 100 L 160 100 A 60 60 0 0 1 142.4 142.4 Z" fill="url(#sliceGradient)" stroke="#DC2626" stroke-width="1"/><rect x="200" y="50" width="80" height="80" rx="8" fill="#FFFFFF" stroke="#FF6B35" stroke-width="2" filter="url(#shadow)"/><text x="240" y="80" font-family="serif" font-size="28" font-weight="bold" fill="#DC2626" text-anchor="middle">3</text><line x1="215" y1="90" x2="265" y2="90" stroke="#DC2626" stroke-width="2"/><text x="240" y="115" font-family="serif" font-size="28" font-weight="bold" fill="#DC2626" text-anchor="middle">8</text></svg>`,
            theory: `<h4 class="text-xl font-semibold mb-3">¬øQu√© es una Fracci√≥n?</h4><p class="mb-4">Una fracci√≥n representa una parte de un todo. Se escribe como un n√∫mero (el <strong>numerador</strong>) sobre otro (el <strong>denominador</strong>).</p><ul class="list-disc list-inside space-y-2 mb-4"><li><strong>Numerador (Arriba):</strong> Indica cu√°ntas partes estamos tomando.</li><li><strong>Denominador (Abajo):</strong> Indica en cu√°ntas partes iguales se dividi√≥ el todo.</li></ul>`,
            examples: `<h4 class="text-xl font-semibold mb-3">Ejemplo 1: Fracci√≥n de un Grupo</h4><p class="mb-3"><strong>Problema:</strong> En una clase hay 10 estudiantes. 4 usan gafas. ¬øQu√© fracci√≥n usa gafas?</p><p class="mb-4 p-3 bg-green-50 rounded-lg"><strong>Soluci√≥n:</strong> El todo es 10 (denominador). La parte es 4 (numerador). La fracci√≥n es <strong>4/10</strong>.</p>`,
            challenge: `<h4 class="text-xl font-semibold mb-3">¬°Ponte a Prueba!</h4><p>Usa la animaci√≥n para responder: ¬øQu√© fracci√≥n es mayor, <strong>2/3</strong> o <strong>5/8</strong>?</p>`
        },
        {
            id: 'plano-cartesiano', title: 'Plano Cartesiano', subject: 'matematicas', url: 'https://fredykwa.github.io/Animaciones-Canvas/Plano-Cartesiano/',
            description: 'Explora coordenadas y ubicaci√≥n de puntos', keywords: 'coordenadas plano cartesiano ejes cuadrantes x y',
            isFeatured: true, isDefault: true, icon: 'üìä', gradient: 'from-blue-600 to-teal-600', color: 'blue',
            objectives: ['Comprender el sistema de coordenadas cartesianas', 'Ubicar puntos usando coordenadas (x, y)', 'Identificar cuadrantes y ejes del plano'],
            controls: ['Haz clic para ubicar puntos en el plano', 'Observa las coordenadas de cada punto', 'Explora los diferentes cuadrantes'],
            svgThumbnail: `<svg viewBox="0 0 300 200" class="w-full h-full"><defs><linearGradient id="axisGradient" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:#1E40AF;stop-opacity:1" /><stop offset="100%" style="stop-color:#3B82F6;stop-opacity:1" /></linearGradient><marker id="arrowhead" markerWidth="12" markerHeight="8" refX="11" refY="4" orient="auto"><polygon points="0 0, 12 4, 0 8" fill="url(#axisGradient)" stroke="#1E40AF" stroke-width="0.5"/></marker><filter id="glow" x="-50%" y="-50%" width="200%" height="200%"><feGaussianBlur stdDeviation="2" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter><filter id="pointShadow" x="-50%" y="-50%" width="200%" height="200%"><feDropShadow dx="1" dy="1" stdDeviation="2" flood-color="#00000040"/></filter></defs><rect x="40" y="20" width="220" height="160" fill="#F8FAFC" stroke="#E2E8F0" stroke-width="1" rx="4"/><g stroke="#CBD5E1" stroke-width="1" opacity="0.6"><line x1="100" y1="20" x2="100" y2="180"/><line x1="200" y1="20" x2="200" y2="180"/><line x1="40" y1="60" x2="260" y2="60"/><line x1="40" y1="140" x2="260" y2="140"/></g><g stroke="#E2E8F0" stroke-width="0.5" opacity="0.4"><line x1="75" y1="20" x2="75" y2="180"/><line x1="125" y1="20" x2="125" y2="180"/><line x1="175" y1="20" x2="175" y2="180"/><line x1="225" y1="20" x2="225" y2="180"/><line x1="40" y1="40" x2="260" y2="40"/><line x1="40" y1="80" x2="260" y2="80"/><line x1="40" y1="120" x2="260" y2="120"/><line x1="40" y1="160" x2="260" y2="160"/></g><line x1="40" y1="100" x2="260" y2="100" stroke="url(#axisGradient)" stroke-width="3" marker-end="url(#arrowhead)" filter="url(#glow)"/><line x1="150" y1="20" x2="150" y2="180" stroke="url(#axisGradient)" stroke-width="3" marker-end="url(#arrowhead)" filter="url(#glow)"/><g stroke="#1E40AF" stroke-width="1.5"><line x1="100" y1="95" x2="100" y2="105"/><line x1="200" y1="95" x2="200" y2="105"/><line x1="145" y1="60" x2="155" y2="60"/><line x1="145" y1="140" x2="155" y2="140"/></g><g font-family="Arial, sans-serif" font-size="10" font-weight="500" fill="#475569"><text x="100" y="115" text-anchor="middle">-1</text><text x="200" y="115" text-anchor="middle">1</text><text x="135" y="65" text-anchor="middle">1</text><text x="135" y="145" text-anchor="middle">-1</text></g><circle cx="200" cy="60" r="6" fill="#EF4444" stroke="#FFFFFF" stroke-width="2" filter="url(#pointShadow)"/><circle cx="100" cy="140" r="6" fill="#10B981" stroke="#FFFFFF" stroke-width="2" filter="url(#pointShadow)"/><circle cx="180" cy="120" r="6" fill="#8B5CF6" stroke="#FFFFFF" stroke-width="2" filter="url(#pointShadow)"/><g font-family="Arial, sans-serif" font-size="10" font-weight="600"><rect x="205" y="45" width="35" height="16" rx="3" fill="#FFFFFF" stroke="#EF4444" stroke-width="1" opacity="0.9"/><text x="222" y="55" text-anchor="middle" fill="#EF4444">(2,1)</text><rect x="65" y="150" width="40" height="16" rx="3" fill="#FFFFFF" stroke="#10B981" stroke-width="1" opacity="0.9"/><text x="85" y="160" text-anchor="middle" fill="#10B981">(-1,-1)</text><rect x="185" y="130" width="35" height="16" rx="3" fill="#FFFFFF" stroke="#8B5CF6" stroke-width="1" opacity="0.9"/><text x="202" y="140" text-anchor="middle" fill="#8B5CF6">(1,-0.5)</text></g><circle cx="270" cy="100" r="12" fill="#1E40AF" opacity="0.1"/><text x="270" y="105" font-family="serif" font-size="16" font-weight="bold" fill="#1E40AF" text-anchor="middle">X</text><circle cx="150" cy="10" r="12" fill="#1E40AF" opacity="0.1"/><text x="150" y="15" font-family="serif" font-size="16" font-weight="bold" fill="#1E40AF" text-anchor="middle">Y</text><circle cx="150" cy="100" r="3" fill="#1E40AF"/><text x="140" y="115" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#1E40AF">O</text></svg>`,
            theory: `<p>El Plano Cartesiano se usa para...</p>`, examples: `<p>Ejemplo de c√≥mo ubicar el punto (2, 3)...</p>`, challenge: `<p>¬øEn qu√© cuadrante se encuentra el punto (-4, 2)?</p>`
        },
        {
            id: 'pendulo', title: 'P√©ndulo Simple', subject: 'fisica', url: 'https://fredykwa.github.io/Animaciones-Canvas/Pendulo/',
            description: 'Explora el movimiento oscilatorio y las leyes de la f√≠sica', keywords: 'pendulo oscilacion periodo energia movimiento fisica',
            isFeatured: true, isDefault: true, icon: '‚öõÔ∏è', gradient: 'from-indigo-600 to-purple-600', color: 'indigo',
            objectives: ['Comprender el movimiento arm√≥nico simple', 'Analizar la relaci√≥n entre per√≠odo y longitud', 'Observar la conservaci√≥n de energ√≠a mec√°nica'],
            controls: ['Ajusta la longitud del p√©ndulo', 'Modifica el √°ngulo inicial de oscilaci√≥n', 'Observa c√≥mo cambia el per√≠odo de oscilaci√≥n'],
            svgThumbnail: `<svg viewBox="0 0 300 200" class="w-full h-full"><defs><linearGradient id="pendulumGradient" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#7C3AED;stop-opacity:1" /><stop offset="100%" style="stop-color:#A855F7;stop-opacity:1" /></linearGradient><linearGradient id="supportGradient" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:#6B7280;stop-opacity:1" /><stop offset="100%" style="stop-color:#374151;stop-opacity:1" /></linearGradient><radialGradient id="massGradient" cx="30%" cy="30%"><stop offset="0%" style="stop-color:#A855F7;stop-opacity:1" /><stop offset="70%" style="stop-color:#7C3AED;stop-opacity:1" /><stop offset="100%" style="stop-color:#5B21B6;stop-opacity:1" /></radialGradient><filter id="pendulumShadow" x="-50%" y="-50%" width="200%" height="200%"><feDropShadow dx="2" dy="2" stdDeviation="3" flood-color="#00000040"/></filter></defs><rect x="0" y="0" width="300" height="200" fill="#F8FAFC"/><rect x="130" y="15" width="40" height="15" rx="3" fill="url(#supportGradient)" stroke="#1F2937" stroke-width="1" filter="url(#pendulumShadow)"/><rect x="135" y="18" width="30" height="3" rx="1" fill="#9CA3AF" opacity="0.7"/><circle cx="150" cy="30" r="4" fill="#374151" stroke="#1F2937" stroke-width="1"/><circle cx="150" cy="30" r="2" fill="#6B7280"/><path d="M 90 140 Q 150 160 210 140" fill="none" stroke="#8B5CF6" stroke-width="3" stroke-dasharray="6,4" opacity="0.7"/><g opacity="0.3"><line x1="150" y1="30" x2="210" y2="140" stroke="#9CA3AF" stroke-width="1"/><circle cx="210" cy="140" r="10" fill="#C084FC" stroke="#A855F7" stroke-width="1"/></g><line x1="150" y1="30" x2="90" y2="140" stroke="#4B5563" stroke-width="3" filter="url(#pendulumShadow)"/><circle cx="90" cy="140" r="16" fill="url(#massGradient)" stroke="#5B21B6" stroke-width="2" filter="url(#pendulumShadow)"/><circle cx="86" cy="136" r="5" fill="#DDD6FE" opacity="0.8"/><line x1="150" y1="30" x2="150" y2="80" stroke="#6B7280" stroke-width="1.5" stroke-dasharray="3,2" opacity="0.7"/><path d="M 150 50 A 20 20 0 0 0 130 65" fill="none" stroke="#7C3AED" stroke-width="2" opacity="0.8"/><text x="135" y="60" font-family="serif" font-size="14" font-weight="bold" fill="#7C3AED">Œ∏</text></svg>`,
            theory: `<p>Un p√©ndulo simple es un sistema f√≠sico que consiste en...</p>`, examples: `<p>Ejemplo: Si duplicamos la longitud, ¬øqu√© pasa con el per√≠odo?</p>`, challenge: `<p>¬øEl per√≠odo del p√©ndulo depende de la masa?</p>`
        }
    ];
    let customAnimations = [];

    // =================================================================================
    // 2. L√ìGICA DE RENDERIZADO DIN√ÅMICO
    // =================================================================================

    function initializeDatabase() {
        customAnimations = JSON.parse(localStorage.getItem('customAnimations') || '[]');
        const deletedDefaults = JSON.parse(localStorage.getItem('deletedDefaultAnimations') || '[]');
        const activeDefaults = ANIMATION_DB.filter(a => !deletedDefaults.includes(a.id));
        return [...activeDefaults, ...customAnimations];
    }

    function createAnimationCard(animation) {
        const subjectIcons = { 'matematicas': 'üìê', 'fisica': '‚öõÔ∏è', 'quimica': '‚öóÔ∏è' };
        const subjectColors = {
            'matematicas': { bg: 'bg-blue-500', grad: 'from-blue-100 to-blue-200' },
            'fisica': { bg: 'bg-purple-500', grad: 'from-purple-100 to-purple-200' },
            'quimica': { bg: 'bg-green-500', grad: 'from-green-100 to-green-200' }
        };
        const colors = subjectColors[animation.subject] || { bg: 'bg-gray-500', grad: 'from-gray-100 to-gray-200' };
        const icon = subjectIcons[animation.subject] || 'üß©';
        const thumbnailHTML = (animation.svgThumbnail && animation.svgThumbnail.startsWith('<svg')) ? animation.svgThumbnail : `<div class="text-6xl opacity-50">${icon}</div>`;
        return `<div class="animation-item animation-card rounded-xl overflow-hidden card-hover cursor-pointer aspect-square" data-subject="${animation.subject}" data-keywords="${animation.keywords} ${animation.title}" role="button" tabindex="0" onclick="loadAnimationById('${animation.id}')" onkeydown="if(event.key==='Enter' || event.key===' ') { event.preventDefault(); loadAnimationById('${animation.id}'); }"><div class="h-3/5 bg-gradient-to-br ${colors.grad} relative overflow-hidden flex items-center justify-center">${thumbnailHTML}<div class="absolute top-3 right-3 ${colors.bg} text-white px-2 py-1 rounded-full text-xs font-semibold shadow-lg">${icon} ${animation.subject.charAt(0).toUpperCase() + animation.subject.slice(1)}</div></div><div class="h-2/5 p-4 flex flex-col justify-center"><h4 class="text-lg font-semibold mb-2 text-center">${animation.title}</h4><p class="text-gray-600 text-sm text-center leading-relaxed">${animation.description}</p></div></div>`;
    }

    function renderAllViews() {
        const allAnimations = initializeDatabase();
        const inicioHTML = `<div class="bg-white rounded-xl shadow-lg overflow-hidden mb-8"><div class="gradient-bg text-white p-8 md:p-12"><h2 class="text-4xl md:text-5xl font-bold mb-4">Bienvenido a Profe Digital Kwa</h2><p class="text-xl text-blue-100 mb-6">Explora conceptos de matem√°ticas y f√≠sica a trav√©s de animaciones interactivas</p><div class="flex flex-wrap gap-4"><button onclick="showSection('matematicas')" class="bg-white text-indigo-600 px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors">üìê Explorar Matem√°ticas</button><button onclick="showSection('fisica')" class="bg-indigo-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-indigo-600 transition-colors">üî¨ Explorar F√≠sica</button></div></div></div><div class="mb-8"><h3 class="text-2xl font-bold text-gray-800 mb-6">üåü Animaciones Destacadas</h3><div class="grid md:grid-cols-3 gap-6">${allAnimations.filter(a => a.isFeatured).map(createAnimationCard).join('')}</div></div><div class="grid md:grid-cols-4 gap-6 mb-8"><div class="bg-white rounded-lg p-6 text-center shadow-md"><div class="text-3xl font-bold text-blue-600 mb-2">${allAnimations.length}</div><div class="text-gray-600">Animaciones</div></div><div class="bg-white rounded-lg p-6 text-center shadow-md"><div class="text-3xl font-bold text-green-600 mb-2">2</div><div class="text-gray-600">Materias</div></div><div class="bg-white rounded-lg p-6 text-center shadow-md"><div class="text-3xl font-bold text-purple-600 mb-2">100%</div><div class="text-gray-600">Interactivo</div></div><div class="bg-white rounded-lg p-6 text-center shadow-md"><div class="text-3xl font-bold text-orange-600 mb-2">‚àû</div><div class="text-gray-600">Posibilidades</div></div></div>`;
        const matematicasHTML = `<div class="bg-white rounded-xl shadow-lg overflow-hidden mb-8"><div class="bg-gradient-to-r from-blue-600 to-teal-600 text-white p-6"><h2 class="text-3xl font-bold mb-2">üìê Matem√°ticas</h2><p class="text-blue-100">Conceptos matem√°ticos visualizados de forma interactiva</p></div></div><div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">${allAnimations.filter(a => a.subject === 'matematicas').map(createAnimationCard).join('')}</div>`;
        const fisicaHTML = `<div class="bg-white rounded-xl shadow-lg overflow-hidden mb-8"><div class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-6"><h2 class="text-3xl font-bold mb-2">üî¨ F√≠sica</h2><p class="text-indigo-100">Fen√≥menos f√≠sicos explicados a trav√©s de simulaciones</p></div></div><div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">${allAnimations.filter(a => a.subject === 'fisica').map(createAnimationCard).join('')}</div>`;
        const todasHTML = `<div class="bg-white rounded-xl shadow-lg overflow-hidden mb-8"><div class="bg-gradient-to-r from-green-600 to-blue-600 text-white p-6"><h2 class="text-3xl font-bold mb-2">üé¨ Todas las Animaciones</h2><p class="text-green-100">Cat√°logo completo</p></div></div><div class="bg-white rounded-lg shadow-md p-6 mb-6"><div class="flex flex-col md:flex-row gap-4"><div class="flex-1"><input type="text" id="searchInput" placeholder="Buscar animaciones..." class="w-full px-4 py-2 border border-gray-300 rounded-lg" onkeyup="filterAnimations()"></div><div class="flex gap-2"><button onclick="filterBySubject('all', event)" class="filter-btn bg-blue-500 text-white px-4 py-2 rounded-lg">Todas</button><button onclick="filterBySubject('matematicas', event)" class="filter-btn bg-blue-100 text-blue-700 px-4 py-2 rounded-lg">Matem√°ticas</button><button onclick="filterBySubject('fisica', event)" class="filter-btn bg-purple-100 text-purple-700 px-4 py-2 rounded-lg">F√≠sica</button></div></div></div><div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6" id="animationsGrid">${allAnimations.map(createAnimationCard).join('')}</div>`;
        document.getElementById('inicio').innerHTML = inicioHTML;
        document.getElementById('matematicas').innerHTML = matematicasHTML;
        document.getElementById('fisica').innerHTML = fisicaHTML;
        document.getElementById('animaciones').innerHTML = todasHTML;
    }
    
    // =================================================================================
    // 3. NAVEGACI√ìN Y L√ìGICA DE VISTAS
    // =================================================================================

    function showSection(sectionName) {
        document.querySelectorAll('.section').forEach(s => s.classList.add('section-hidden'));
        document.getElementById(sectionName).classList.remove('section-hidden');
        updateBreadcrumb(sectionName);
        document.getElementById('mobileMenu').classList.add('hidden');
        window.scrollTo(0, 0);
    }

    function updateBreadcrumb(sectionName) {
        const breadcrumbSection = document.getElementById('breadcrumbSection');
        const breadcrumbText = document.getElementById('breadcrumbText');
        const sectionNames = { 'matematicas': 'Matem√°ticas', 'fisica': 'F√≠sica', 'animaciones': 'Todas las Animaciones', 'animationDetail': 'Detalle de Animaci√≥n' };
        if (sectionName === 'inicio') { breadcrumbSection.classList.add('hidden'); }
        else { breadcrumbSection.classList.remove('hidden'); breadcrumbText.textContent = sectionNames[sectionName] || sectionName; }
    }

    function toggleMobileMenu() { document.getElementById('mobileMenu').classList.toggle('hidden'); }

    function loadAnimationById(animationId) {
        const animation = initializeDatabase().find(a => a.id === animationId);
        if (!animation) { console.error('Animation not found:', animationId); return; }
        const createListItems = (items, color) => (items || []).map(item => `<li class="flex items-start"><span class="text-${color}-500 mr-2">‚Ä¢</span>${item}</li>`).join('');
        const hasTheory = animation.theory && animation.theory.trim().length > 5, hasExamples = animation.examples && animation.examples.trim().length > 5, hasChallenge = animation.challenge && animation.challenge.trim().length > 5, hasLessonContent = hasTheory || hasExamples || hasChallenge;
        const content = `<div class="bg-white rounded-xl shadow-lg overflow-hidden mb-8"><div class="bg-gradient-to-r ${animation.gradient} text-white p-6"><h2 class="text-3xl font-bold mb-2">${animation.title}</h2><p class="text-${animation.color}-100">${animation.description}</p></div><div class="p-6"><div class="bg-gray-50 rounded-lg p-4 mb-6"><div class="flex items-center justify-between mb-4"><div class="flex items-center space-x-3"><div class="w-3 h-3 bg-red-500 rounded-full"></div><div class="w-3 h-3 bg-yellow-500 rounded-full"></div><div class="w-3 h-3 bg-green-500 rounded-full"></div><span class="text-sm text-gray-600 ml-4">Animaci√≥n Interactiva</span></div><button onclick="toggleFullscreen('${animation.id}')" class="bg-blue-600 text-white px-4 py-2 rounded-lg">üì∫ Pantalla Completa</button></div><div id="animationContainer-${animation.id}" class="w-full bg-white rounded-lg shadow-inner"><iframe id="animationFrame-${animation.id}" src="${animation.url}" class="w-full h-96 md:h-[600px] border-0 rounded-lg" title="${animation.title}"></iframe></div></div><div class="grid md:grid-cols-2 gap-6 mb-8"><div class="bg-${animation.color}-50 p-6 rounded-lg"><h3 class="text-xl font-semibold text-${animation.color}-800 mb-3">üéØ Objetivos</h3><ul class="space-y-2 text-${animation.color}-700">${createListItems(animation.objectives, animation.color)}</ul></div><div class="bg-green-50 p-6 rounded-lg"><h3 class="text-xl font-semibold text-green-800 mb-3">üîß Controles</h3><ul class="space-y-2 text-green-700">${createListItems(animation.controls, 'green')}</ul></div></div>${hasLessonContent ? `<div class="bg-white rounded-xl shadow-lg overflow-hidden mt-8"><h3 class="text-2xl font-bold text-gray-800 p-6 border-b">Lecci√≥n Completa</h3><nav class="flex border-b">${hasTheory ? `<span id="tab-theory" class="lesson-tab active" onclick="showLessonTab('theory')">üìñ Explicaci√≥n</span>` : ''}${hasExamples ? `<span id="tab-examples" class="lesson-tab ${!hasTheory ? 'active' : ''}" onclick="showLessonTab('examples')">üí° Ejemplos</span>` : ''}${hasChallenge ? `<span id="tab-challenge" class="lesson-tab ${!hasTheory && !hasExamples ? 'active' : ''}" onclick="showLessonTab('challenge')">üß† Desaf√≠o</span>` : ''}</nav><div class="p-6 prose max-w-none">${hasTheory ? `<div id="content-theory" class="lesson-content active">${animation.theory}</div>` : ''}${hasExamples ? `<div id="content-examples" class="lesson-content ${!hasTheory ? 'active' : ''}">${animation.examples}</div>` : ''}${hasChallenge ? `<div id="content-challenge" class="lesson-content ${!hasTheory && !hasExamples ? 'active' : ''}">${animation.challenge}</div>` : ''}</div></div>` : ''}<div class="flex flex-wrap gap-4 justify-center mt-12"><button onclick="resetAnimation('${animation.id}')" class="bg-orange-600 text-white px-6 py-3 rounded-lg flex items-center space-x-2"><span>üîÑ</span><span>Reiniciar</span></button><button onclick="shareAnimation('${animation.id}')" class="bg-green-600 text-white px-6 py-3 rounded-lg flex items-center space-x-2"><span>üì§</span><span>Compartir</span></button><button onclick="downloadNotes('${animation.id}')" class="bg-purple-600 text-white px-6 py-3 rounded-lg flex items-center space-x-2"><span>üìù</span><span>Descargar Resumen</span></button></div></div></div>`;
        document.getElementById('animationContent').innerHTML = content;
        showSection('animationDetail');
    }

    function showLessonTab(tabName) {
        document.querySelectorAll('.lesson-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.lesson-tab').forEach(t => t.classList.remove('active'));
        document.getElementById(`content-${tabName}`).classList.add('active');
        document.getElementById(`tab-${tabName}`).classList.add('active');
    }

    // =================================================================================
    // 4. FUNCIONES DE UTILIDAD (COMPARTIR, DESCARGAR, ETC.)
    // =================================================================================

    function toggleFullscreen(id) { document.getElementById(`animationContainer-${id}`)?.requestFullscreen().catch(err => alert(`Error: ${err.message}`)); }
    function resetAnimation(id) { const iframe = document.getElementById(`animationFrame-${id}`); if (iframe) iframe.src = iframe.src; }
    
    function shareAnimation(animationId) {
        const animation = initializeDatabase().find(a => a.id === animationId);
        if (!animation) return;
        const shareURL = new URL(PORTAL_URL); shareURL.searchParams.set('animacion', animation.id);
        const urlString = shareURL.toString();
        if (navigator.share) { navigator.share({ title: `${animation.title} - Profe Digital Kwa`, text: 'Mira esta animaci√≥n educativa', url: urlString }); }
        else { navigator.clipboard.writeText(urlString).then(() => alert('¬°Enlace copiado al portapapeles!')); }
    }

    function downloadNotes(animationId) {
        const animation = initializeDatabase().find(a => a.id === animationId);
        if (!animation) return alert('No hay notas disponibles.');
        const stripHtml = (html) => new DOMParser().parseFromString(html, 'text/html').body.textContent || "";
        let content = `LECCI√ìN: ${animation.title.toUpperCase()}\n==================================\n\n`;
        if (animation.theory) content += `üìñ EXPLICACI√ìN TE√ìRICA\n----------------------\n${stripHtml(animation.theory)}\n\n`;
        if (animation.examples) content += `üí° EJEMPLOS RESUELTOS\n----------------------\n${stripHtml(animation.examples)}\n\n`;
        if (animation.challenge) content += `üß† DESAF√çO\n----------------------\n${stripHtml(animation.challenge)}\n\n`;
        const blob = new Blob([content + '---\nGenerado por Profe Digital Kwa'], { type: 'text/plain;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = `${animation.id}-leccion.txt`; a.click();
        URL.revokeObjectURL(url);
    }

    // =================================================================================
    // 5. B√öSQUEDA Y FILTRADO
    // =================================================================================

    function filterAnimations() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        document.querySelectorAll('#animationsGrid .animation-item').forEach(anim => { anim.style.display = anim.dataset.keywords.toLowerCase().includes(searchTerm) ? 'block' : 'none'; });
    }

    function filterBySubject(subject, event) {
        document.querySelectorAll('.filter-btn').forEach(btn => { btn.classList.remove('bg-blue-500', 'text-white', 'bg-purple-500'); btn.classList.add('bg-blue-100', 'text-blue-700'); });
        const activeClasses = subject === 'fisica' ? ['bg-purple-500', 'text-white'] : ['bg-blue-500', 'text-white'];
        event.target.classList.remove('bg-blue-100', 'text-blue-700');
        event.target.classList.add(...activeClasses);
        document.querySelectorAll('#animationsGrid .animation-item').forEach(anim => { anim.style.display = (subject === 'all' || anim.dataset.subject === subject) ? 'block' : 'none'; });
    }

    // =================================================================================
    // 6. L√ìGICA DEL PANEL DE ADMINISTRACI√ìN
    // =================================================================================

    function toggleAdminPanel() {
        const panel = document.getElementById('adminPanel');
        panel.classList.toggle('hidden');
        if (!panel.classList.contains('hidden')) {
            loadExistingAnimations();
        }
    }

    function showAdminTab(tabName, event) {
        document.querySelectorAll('.admin-tab-content').forEach(t => t.classList.add('hidden'));
        document.querySelectorAll('.admin-tab-btn').forEach(b => { b.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600'); b.classList.add('text-gray-500'); });
        document.getElementById(`admin${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`).classList.remove('hidden');
        event.target.classList.remove('text-gray-500');
        event.target.classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
    }

    function loadExistingAnimations() {
        const container = document.getElementById('existingAnimations');
        container.innerHTML = initializeDatabase().map(animation => `
            <div class="bg-gray-50 p-4 rounded-lg flex items-center justify-between">
                <div><h5 class="font-semibold">${animation.title}</h5><p class="text-sm text-gray-600">${animation.subject}${animation.isDefault ? ' (Predeterminada)' : ''}</p></div>
                <div class="flex space-x-2">
                    ${!animation.isDefault ? `<button onclick="editAnimation('${animation.id}')" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">‚úèÔ∏è Editar</button>` : ''}
                    <button onclick="deleteAnimation('${animation.id}')" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600">üóëÔ∏è Eliminar</button>
                </div>
            </div>`).join('');
    }

    function getGradientForSubject(s) { return {matematicas:'from-blue-600 to-teal-600',fisica:'from-indigo-600 to-purple-600',quimica:'from-green-600 to-emerald-600'}[s] || 'from-gray-600 to-gray-700'; }
    function getColorForSubject(s) { return {matematicas:'blue',fisica:'indigo',quimica:'green'}[s] || 'gray'; }
    function resetAdminForm() { document.getElementById('addAnimationForm').reset(); document.getElementById('animationId').value = ''; document.getElementById('formSubmitButton').innerHTML = '‚ûï Agregar Animaci√≥n'; document.getElementById('formCancelButton').classList.add('hidden'); }

    function deleteAnimation(animationId) {
        if (!confirm('¬øEst√°s seguro de que quieres eliminar esta animaci√≥n?')) return;
        const animationToDelete = initializeDatabase().find(a => a.id === animationId);
        if (animationToDelete.isDefault) {
            let deletedDefaults = JSON.parse(localStorage.getItem('deletedDefaultAnimations') || '[]');
            if (!deletedDefaults.includes(animationId)) { deletedDefaults.push(animationId); localStorage.setItem('deletedDefaultAnimations', JSON.stringify(deletedDefaults)); }
        } else {
            let currentAnimations = JSON.parse(localStorage.getItem('customAnimations') || '[]');
            localStorage.setItem('customAnimations', JSON.stringify(currentAnimations.filter(a => a.id !== animationId)));
        }
        renderAllViews();
        loadExistingAnimations();
    }

    function editAnimation(animationId) {
        const animationToEdit = customAnimations.find(a => a.id === animationId);
        if (!animationToEdit) return;
        document.getElementById('animationId').value = animationToEdit.id;
        document.getElementById('animationTitle').value = animationToEdit.title;
        document.getElementById('animationSubject').value = animationToEdit.subject;
        document.getElementById('animationUrl').value = animationToEdit.url;
        document.getElementById('animationDescription').value = animationToEdit.description;
        document.getElementById('animationKeywords').value = animationToEdit.keywords;
        document.getElementById('animationObjectives').value = (animationToEdit.objectives || []).join('\n');
        document.getElementById('animationControls').value = (animationToEdit.controls || []).join('\n');
        document.getElementById('animationTheory').value = animationToEdit.theory || '';
        document.getElementById('animationExamples').value = animationToEdit.examples || '';
        document.getElementById('animationChallenge').value = animationToEdit.challenge || '';
        document.getElementById('formSubmitButton').innerHTML = 'üíæ Actualizar Animaci√≥n';
        document.getElementById('formCancelButton').classList.remove('hidden');
        document.getElementById('adminPanel').scrollTop = 0;
        document.getElementById('animationTitle').focus();
    }
    
    function loadSiteContent(contentData) { /* (C√≥digo sin cambios) */ }

    // =================================================================================
    // 7. INICIALIZACI√ìN DE LA P√ÅGINA
    // =================================================================================

    document.addEventListener('DOMContentLoaded', function() {
        const savedContent = JSON.parse(localStorage.getItem('siteContent') || '{}');
        loadSiteContent(savedContent);
        renderAllViews();
        const urlParams = new URLSearchParams(window.location.search);
        const animacionParaCargar = urlParams.get('animacion');
        if (animacionParaCargar) { loadAnimationById(animacionParaCargar); }
        else { showSection('inicio'); }
        
        document.getElementById('addAnimationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const editingId = document.getElementById('animationId').value;
            const subject = document.getElementById('animationSubject').value;
            const animationData = {
                title: document.getElementById('animationTitle').value, subject: subject,
                url: document.getElementById('animationUrl').value, description: document.getElementById('animationDescription').value,
                keywords: document.getElementById('animationKeywords').value,
                objectives: document.getElementById('animationObjectives').value.split('\n').filter(t => t.trim()),
                controls: document.getElementById('animationControls').value.split('\n').filter(t => t.trim()),
                gradient: getGradientForSubject(subject), color: getColorForSubject(subject), isDefault: false, isFeatured: true,
                theory: document.getElementById('animationTheory').value, examples: document.getElementById('animationExamples').value,
                challenge: document.getElementById('animationChallenge').value
            };
            
            let currentAnimations = JSON.parse(localStorage.getItem('customAnimations') || '[]');
            if (editingId) { // MODO EDICI√ìN
                const index = currentAnimations.findIndex(a => a.id === editingId);
                if (index > -1) {
                    currentAnimations[index] = { ...currentAnimations[index], ...animationData };
                    alert('¬°Animaci√≥n actualizada exitosamente!');
                }
            } else { // MODO AGREGAR
                currentAnimations.push({ ...animationData, id: 'custom_' + Date.now() });
                alert('¬°Animaci√≥n agregada exitosamente!');
            }
            
            localStorage.setItem('customAnimations', JSON.stringify(currentAnimations));
            renderAllViews();
            resetAdminForm();
            loadExistingAnimations();
        });
    });
</script>
</body>
</html>

